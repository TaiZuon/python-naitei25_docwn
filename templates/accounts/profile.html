{% extends "base_home.html" %}
{% load i18n %}
{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static 'accounts/css/profile.css' %}" />
{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <div class="profile-avatar-section">
            <div class="avatar-preview">
                <img src="{{ avatar_info.avatar_url }}" 
                     alt="{% trans 'Ảnh đại diện' %}" 
                     class="avatar-img"
                     id="avatarPreview">
            </div>
            <div class="user-info">
                <h2 class="user-name">{{ profile.get_name }}</h2>
                <p class="user-email">{{ user.email }}</p>
                <div class="user-badges">
                    {% if user.is_email_verified %}
                        <span class="badge badge-verified">✓ {% trans "Email đã xác thực" %}</span>
                    {% else %}
                        <span class="badge badge-unverified">! {% trans "Email chưa xác thực" %}</span>
                    {% endif %}
                    <span class="badge badge-role role-{{ user.role }}">{{ user.get_role_display }}</span>
                </div>
            </div>
        </div>
    </div>

    <div class="profile-form-container">
        <h3 class="form-title">
            <i class="icon-edit"></i>
            {% trans "Cập nhật thông tin cá nhân" %}
        </h3>
        
        <form method="post" enctype="multipart/form-data" class="profile-form">
            {% csrf_token %}
            
            <div class="form-grid">
                <!-- Avatar Upload -->
                <div class="form-group avatar-upload-group">
                    <label class="form-label">
                        <i class="icon-camera"></i>
                        {% trans "Ảnh đại diện" %}
                    </label>
                    <div class="avatar-upload">
                        {{ form.avatar_upload }}
                        <label for="{{ form.avatar_upload.id_for_label }}" class="upload-btn {% if not image_service_status.available %}disabled{% endif %}">
                            <i class="icon-upload"></i>
                            {% if image_service_status.available %}
                                {% trans "Chọn ảnh để upload" %}
                            {% else %}
                                {% trans "Dịch vụ không khả dụng" %}
                            {% endif %}
                        </label>
                    </div>
                    {% if form.avatar_upload.help_text %}
                        <small class="help-text">{{ form.avatar_upload.help_text }}</small>
                    {% endif %}
                    {% if form.avatar_upload.errors %}
                        <div class="error-message">
                            {% for error in form.avatar_upload.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Display Name -->
                <div class="form-group">
                    <label for="{{ form.display_name.id_for_label }}" class="form-label">
                        <i class="icon-user"></i>
                        {{ form.display_name.label }}
                    </label>
                    {{ form.display_name }}
                    {% if form.display_name.help_text %}
                        <small class="help-text">{{ form.display_name.help_text }}</small>
                    {% endif %}
                    {% if form.display_name.errors %}
                        <div class="error-message">
                            {% for error in form.display_name.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Gender -->
                <div class="form-group">
                    <label for="{{ form.gender.id_for_label }}" class="form-label">
                        <i class="icon-gender"></i>
                        {{ form.gender.label }}
                    </label>
                    <div class="select-wrapper">
                        {{ form.gender }}
                    </div>
                    {% if form.gender.errors %}
                        <div class="error-message">
                            {% for error in form.gender.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Birthday -->
                <div class="form-group">
                    <label for="{{ form.birthday.id_for_label }}" class="form-label">
                        <i class="icon-calendar"></i>
                        {{ form.birthday.label }}
                    </label>
                    {{ form.birthday }}
                    {% if form.birthday.errors %}
                        <div class="error-message">
                            {% for error in form.birthday.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Description -->
                <div class="form-group full-width">
                    <label for="{{ form.description.id_for_label }}" class="form-label">
                        <i class="icon-info"></i>
                        {{ form.description.label }}
                    </label>
                    {{ form.description }}
                    {% if form.description.help_text %}
                        <small class="help-text">{{ form.description.help_text }}</small>
                    {% endif %}
                    {% if form.description.errors %}
                        <div class="error-message">
                            {% for error in form.description.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Interest -->
                <div class="form-group full-width">
                    <label for="{{ form.interest.id_for_label }}" class="form-label">
                        <i class="icon-heart"></i>
                        {{ form.interest.label }}
                    </label>
                    {{ form.interest }}
                    {% if form.interest.help_text %}
                        <small class="help-text">{{ form.interest.help_text }}</small>
                    {% endif %}
                    {% if form.interest.errors %}
                        <div class="error-message">
                            {% for error in form.interest.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="icon-save"></i>
                    {% trans "Cập nhật thông tin" %}
                </button>
                <button type="reset" class="btn btn-secondary">
                    <i class="icon-refresh"></i>
                    {% trans "Đặt lại" %}
                </button>
            </div>
        </form>
    </div>

    <div class="profile-actions">
        <div class="action-links">
            <a href="{% url 'accounts:change_password' %}" class="action-link">
                <i class="icon-lock"></i>
                {% trans "Đổi mật khẩu" %}
            </a>
            <a href="{% url 'accounts:logout' %}" class="action-link logout">
                <i class="icon-logout"></i>
                {% trans "Đăng xuất" %}
            </a>
        </div>
    </div>

    <!-- Service Status Info -->
    {% if not image_service_status.available %}
    <div class="service-notice warning">
        <i class="icon-warning"></i>
        <div>
            <h4>{% trans "Dịch vụ upload ảnh tạm thời không khả dụng" %}</h4>
            <p>{% trans "Bạn vẫn có thể cập nhật thông tin khác. Tính năng upload ảnh sẽ được khôi phục sớm." %}</p>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block script %}
    <script src="{% static 'accounts/js/profile.js' %}"></script>
{% endblock script %}
