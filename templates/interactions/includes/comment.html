{% load i18n %}
<li id="comment-{{ comment.id }}" class="mb-4">
  <div class="d-flex">
    <div class="flex-shrink-0">
      <img src="{{ comment.user.profile.get_avatar }}" alt="Avatar" class="rounded-circle me-2">
    </div>
    <div class="flex-grow-1">
      <div class="bg-body-secondary p-3 rounded shadow-sm">
        <div class="d-flex justify-content-between">
          <strong>{{ comment.user.username }}</strong>
          <span class="text-muted small">{{ comment.created_at|date:"SHORT_DATETIME_FORMAT" }}</span>
        </div>
        <p class="mb-1">{{ comment.content }}</p>
      </div>

      <div class="d-flex mt-2">
        {% if user.is_authenticated %}
          <button class="btn btn-link btn-sm text-decoration-none reply-btn" data-id="{{ comment.id }}">
            {% trans "Trả lời" %}
          </button>
        {% endif %}
        {% if comment.user == user %}
          <button type="button"
                  class="btn btn-link btn-sm text-danger delete-btn ms-2"
                  data-id="{{ comment.id }}"
                  data-url="{% url 'interactions:delete_comment' comment.id %}">
            {% trans "Xóa" %}
          </button>
        {% endif %}
      </div>

      <!-- Form reply ẩn -->
      <form method="post"
            action="{% url 'interactions:add_comment' novel_slug %}"
            class="reply-form mt-2 d-none comment-form"
            id="reply-form-{{ comment.id }}">
        {% csrf_token %}
        <textarea name="content" rows="2" class="form-control mb-1"
                  placeholder="{% trans 'Nhập trả lời...' %}"></textarea>
        <input type="hidden" name="parent_comment_id" value="{{ comment.id }}">
        <button type="submit" class="btn btn-primary btn-sm">{% trans "Đăng" %}</button>
      </form>

      <!-- Replies -->
      {% if comment.get_replies %}
        <ul class="list-unstyled ms-5 mt-2 replies">
          {% for reply in comment.get_replies %}
            {% include "interactions/includes/reply.html" with comment=reply %}
          {% endfor %}
        </ul>
      {% endif %}
    </div>
  </div>
</li>
