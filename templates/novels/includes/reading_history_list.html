{% load i18n %}

<!-- Reading History List Section -->
<div id="novel-list" class="reading-history-list-section">
    <div class="row">
        <div class="col-12">
            {% if novels %}
                {% for novel in novels %}
                <div class="reading-history-card mb-3">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            {% if novel.image_url %}
                                <img src="{{ novel.image_url }}" alt="{{ novel.name }}" class="novel-image">
                            {% else %}
                                <div class="novel-image bg-light d-flex align-items-center justify-content-center">
                                    <i class="bx bx-book text-muted"></i>
                                </div>
                            {% endif %}
                        </div>
                        <div class="col">
                            <div class="row">
                                <div class="col-md-8">
                                    <h5 class="novel-title">
                                        <a href="{% url 'novels:novel_detail' novel_slug=novel.slug %}">
                                            {{ novel.name }}
                                        </a>
                                    </h5>
                                    <p class="novel-summary">{{ novel.summary|truncatewords:SUMMARY_TRUNCATE_WORDS }}</p>
                                    {% if novel.current_chapter %}
                                        <p class="text-muted mb-1">
                                            {{ novel.current_chapter.title }}
                                        </p>
                                    {% endif %}
                                    <div class="novel-meta">
                                        {% if novel.author_name %}
                                            <small><i class="bx bx-user"></i> {{ novel.author_name }}</small>
                                        {% endif %}
                                        {% if novel.tag_list %}
                                            <small><i class="bx bx-tag"></i>
                                                {% for tag in novel.tag_list %}
                                                    {{ tag.name }}{% if not forloop.last %}, {% endif %}
                                                {% endfor %}
                                            </small>
                                        {% endif %}
                                    </div>
                                    <div class="reading-dates">
                                        {% trans "Đọc lần cuối" %}: {{ novel.last_read_at|date:DATE_FORMAT_DMYHI }}
                                        | {% trans "Đã đọc" %}: {{ novel.chapters_read }} {% trans "chương" %}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="novel-actions d-flex flex-column align-items-start gap-2">
                                        <div class="novel-stats mb-2">
                                            <small><i class="bx bx-show"></i> {{ novel.view_count }}</small>
                                            <small><i class="bx bx-heart"></i> {{ novel.favorite_count|default:0 }}</small>
                                            {% if novel.rating_display %}
                                                <small><i class="bx bx-star"></i> {{ novel.rating_display|floatformat:1 }}</small>
                                            {% endif %}
                                        </div>
                                        <div class="action-buttons d-flex gap-2">
                                            <a href="{% if novel.current_chapter %}
                                                        {% url 'novels:chapter_detail' novel_slug=novel.slug chapter_slug=novel.current_chapter.slug %}
                                                    {% else %}
                                                        {% url 'novels:novel_detail' novel_slug=novel.slug %}
                                                    {% endif %}" 
                                               class="btn btn-outline-primary btn-sm">
                                                <i class="bx bx-book-open"></i>
                                                {% trans "Tiếp tục đọc" %}
                                            </a>
                                            <a href="{% url 'novels:novel_detail' novel_slug=novel.slug %}" 
                                               class="btn btn-outline-secondary btn-sm">
                                                <i class="bx bx-info-circle"></i>
                                                {% trans "Chi tiết" %}
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}

                <!-- Pagination Controls -->
                {% if page_obj.has_other_pages %}
                <div class="pagination-wrapper mt-4">
                    <nav aria-label="{% trans 'Phân trang lịch sử đọc' %}">
                        <ul class="pagination justify-content-center">
                            {% if page_obj.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" href="?page=1{% if search_query %}&q={{ search_query }}{% endif %}">«</a>
                                </li>
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}">‹</a>
                                </li>
                            {% endif %}
                            {% for num in page_obj.paginator.page_range %}
                                {% if num >= pagination_start and num <= pagination_end %}
                                    {% if page_obj.number == num %}
                                        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                                    {% else %}
                                        <li class="page-item">
                                            <a class="page-link" href="?page={{ num }}{% if search_query %}&q={{ search_query }}{% endif %}">{{ num }}</a>
                                        </li>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                            {% if page_obj.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}">›</a>
                                </li>
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&q={{ search_query }}{% endif %}">»</a>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>
                {% endif %}
            {% else %}
                <div class="empty-state text-center py-5">
                    <i class="bx bx-book-bookmark empty-icon"></i>
                    <h3>{% trans "Chưa có lịch sử đọc" %}</h3>
                    {% if search_query or tag_filter %}
                        <p class="text-muted">{% trans "Không tìm thấy tiểu thuyết nào phù hợp với bộ lọc của bạn." %}</p>
                        <a href="{% url 'novels:reading_history' %}" class="btn btn-outline-primary">
                            <i class="bx bx-refresh"></i>
                            {% trans "Xóa bộ lọc" %}
                        </a>
                    {% else %}
                        <p class="text-muted">{% trans "Bạn chưa đọc tiểu thuyết nào. Hãy bắt đầu khám phá thư viện của chúng tôi!" %}</p>
                        <a href="{% url 'novels:home' %}" class="btn btn-primary">
                            <i class="bx bx-book-open"></i>
                            {% trans "Khám phá tiểu thuyết" %}
                        </a>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>
</div>
